%% Random Photon Absorption Model

dt = 1e-3;
t = 0:dt:1;
tend = max(t);

NT = zeros(30000,length(t));
Nphoton = 1000;

for i = 1:length(t)
    NT(:,i) = RPAM(Nphoton);
end


%% Initialize Parameters

% la between 0.1 and 1
% ns = 1 if dim and 2 if bright

la = 0.5;
n_s = 2;
parameters;

%% Initialization of Matrices

X = cell(7,1);

for m = 1:7
    X{m} = zeros(1,1);
end

X{1}(1) = N_ph(1);
X{2}(1) = 50;
X{3}(1) = 0;
X{4}(1) = 0;
X{5}(1) = 0;
X{6}(1) = 0;
X{7}(1) = 0;

Ca2 = rand; 

% Hill functions for positive and negative feedback
fp = ((Ca2/K_p)^m_p)/(1+(Ca2/K_p)^m_p);
fn = n_s*((X(6)/K_n)^m_n)/(1+(X(6)/K_n)^m_n);

% Transition matrix
V = zeros(7,12);
V(1,1) = -1;
V(2,2) = -1;
V(2,5) = 1;
V(3,2) = 1;
V(3,3) = -1;
V(3,4) = -1;
V(4,3) = 1;
V(4,7) = -1;
V(5,6) = 1;
V(5,8) = -1;
V(5,9) = -2;
V(6,11) = 1;
V(6,12) = -1;
V(7,9) = 1;
V(7,10) = -1;

h = [X{1}(1); X{1}(1)*X{2}(1); X{3}(1)*(PLC_T - X{4}(1)); X{3}(1)*X{4}(1); 
    (G_T - X{3}(1) - X{2}(1) - X{4}(1)); X{4}(1); X{4}(1); X{5}(1); 
    .5*(X{5}(1)*(X{5}(1)-1)*(T_T-X{7}(1))); X{7}(1); C_T - X{6}(1); X{6}(1)];

c = [Gamma_Mstar*(1+h_Mstar*fn); Kappa_Gstar; Kappa_PLCstar; Gamma_GAP; 
    Gamma_G; Kappa_Dstar; Gamma_PLCstar*(1+h_PLCstar*fn); 
    Gamma_Dstar*(1+h_Dstar*fn); Kappa_Tstar*(1+h_TstarP*fp)/Kappa_Dstar^2;
    Gamma_Tstar*(1+h_TstarN*fn); K_u/v^2; K_r];

I_in = I_Tstar * X(7,1);      % Initialize input current (X(7,1) is Tstar)
I_Ca = P_Ca * I_in;         % Calcium Current ~40%
I_NaCa = K_NaCa*(((Na_i^3)*(Ca_o^2)) - ((Na_o^3)*Ca2*exp(V_m*F/R/T)));
I_Canet = I_Ca - 2*I_NaCa;

tt = 1;
mu = 1;                     % Reaction to perform each dt
av = zeros(1,7);            % For determining mu

Z = [0, 50, 0, 0, 0, 0, 0];
Ca = .001;
[Z z] = Signal_Cascade(X_old{:}(1),
    
%{    
for mv = 1:30000
    
    while tt <= tend
        
        Xn = Signal_Cascade(X, NT(mv,tt), tt, h, c, as, dt);
    
        for m = 1:7
            X{m} = [X{m} Xn(m)];
        end
        
        tt = tt + 1;
    
    
    
    
    
    end 
    
end
%}




